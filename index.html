<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Frame Generator | Bangladesh Jamaat-e-Islami</title>
    
    <!-- Google Fonts: Hind Siliguri -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- STYLISH DESIGN SYSTEM --- */
        :root {
            --primary: #006a4e;
            --primary-dark: #004d38;
            --accent: #f42a41;
            --bg-gradient: linear-gradient(135deg, #f0f2f5 0%, #e1e4e8 100%);
            --glass-bg: rgba(255, 255, 255, 0.98);
            --shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background: var(--bg-gradient);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- GLOBAL HEADER --- */
        .site-header {
            width: 100%;
            background: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .site-header img {
            height: 50px;
            vertical-align: middle;
        }
        
        .site-header h3 {
            margin: 5px 0 0;
            color: var(--primary);
            font-size: 18px;
        }

        /* --- APP CONTAINER --- */
        .app-card {
            background: var(--glass-bg);
            width: 95%;
            max-width: 1100px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: row; /* Desktop Default */
            margin: 20px auto;
            border: 1px solid rgba(255,255,255,0.5);
        }

        /* Mobile Layout */
        @media (max-width: 850px) {
            .app-card { flex-direction: column; }
            .canvas-area { padding: 30px 20px; }
            .controls-area { padding: 25px 20px; }
        }

        /* --- LEFT: CANVAS AREA --- */
        .canvas-area {
            flex: 1.2;
            background: #f8f9fa;
            padding: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(0,0,0,0.05);
            position: relative;
        }

        /* Checkered background for transparency feel */
        .canvas-wrapper {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1 / 1;
            background-color: #ffffff;
            background-image: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f0f0f0 75%), linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border: 8px solid white;
            border-radius: 4px; /* Slight radius for the frame container */
            overflow: hidden;
            position: relative;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        canvas {
            width: 100%;
            height: 100%;
            cursor: move; /* Indicates draggable */
            touch-action: none;
            display: block;
        }

        .instruction-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #888;
            pointer-events: none;
            width: 90%;
            z-index: 10;
            background: rgba(255,255,255,0.9);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .tip-badge {
            margin-top: 20px;
            background: white;
            color: #555;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- RIGHT: CONTROLS AREA --- */
        .controls-area {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
            max-height: 100vh;
            background: white;
        }

        .header-controls h1 { color: var(--primary); margin: 0; font-size: 28px; line-height: 1.2; font-weight: 700; }
        .header-controls h2 { font-size: 16px; color: #666; margin: 5px 0 0 0; font-weight: 400; }

        .control-group {
            background: #fff;
            padding: 5px 0;
            transition: 0.2s;
        }

        label { display: block; font-weight: 700; margin-bottom: 12px; color: #2d3436; font-size: 15px; letter-spacing: 0.5px; }

        /* Stylish Buttons */
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s;
            font-family: 'Hind Siliguri', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-upload {
            background: #f8f9fa;
            border: 2px dashed #cbd5e0;
            color: #4a5568;
        }
        .btn-upload:hover { background: #f0fdf4; border-color: var(--primary); color: var(--primary); }

        .btn-download {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0, 106, 78, 0.3);
        }
        .btn-download:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 106, 78, 0.4); }

        /* Form Elements */
        select {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #e2e8f0;
            font-family: inherit; font-size: 15px; background: #f8f9fa; cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23006a4e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            transition: border-color 0.2s;
        }
        select:focus { outline: none; border-color: var(--primary); }
        
        input[type=range] {
            width: 100%; cursor: pointer; height: 6px; background: #e2e8f0; border-radius: 5px; appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            appearance: none; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Checkbox */
        .checkbox-wrapper {
            display: flex; align-items: center; gap: 10px; margin-top: 15px;
            font-size: 15px; color: #555; cursor: pointer;
            padding: 10px; background: #f8f9fa; border-radius: 8px;
        }
        input[type="checkbox"] {
            width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary);
        }

        .hidden { display: none; }
        .loader { display: none; color: var(--primary); font-size: 14px; font-weight: 600; text-align: center; margin-top: 10px; }

        /* --- GLOBAL FOOTER --- */
        .site-footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 14px;
            width: 100%;
            background: white;
            border-top: 1px solid #eee;
        }

    </style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
    <h3>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ</h3>
</header>

<div class="app-card">
    <!-- LEFT: Canvas Preview -->
    <div class="canvas-area">
        <div class="canvas-wrapper" id="canvasContainer">
            <!-- 1080x1080 Resolution -->
            <canvas id="mainCanvas" width="1080" height="1080"></canvas>
            
            <div class="instruction-overlay" id="startMsg">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#aaa" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <h3 style="margin: 10px 0 0; font-weight: 600; color: #555;">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <p style="margin: 5px 0 0; font-size: 14px; color: #888;">‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡ßá ‡¶¨‡¶∏‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>
        <div class="tip-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
            ‡¶ü‡¶ø‡¶™‡¶∏: ‡¶õ‡¶¨‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßã‡¶ó‡ßã ‡¶Ü‡¶ô‡ßÅ‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ü‡ßá‡¶®‡ßá ‡¶™‡¶ú‡¶ø‡¶∂‡¶® ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
        </div>
    </div>

    <!-- RIGHT: Controls -->
    <div class="controls-area">
        <div class="header-controls">
            <h1>‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶£‡¶æ ‡¶´‡ßç‡¶∞‡ßá‡¶Æ</h1>
            <h2>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶õ‡¶¨‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; width: 100%;">

        <!-- 1. Upload -->
        <div class="control-group">
            <label>‡ßß. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <button class="btn btn-upload" onclick="document.getElementById('uploadInput').click()">
                <span>üì∑</span> ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶®
            </button>
            <input type="file" id="uploadInput" class="hidden" accept="image/*">
        </div>

        <!-- 2. Frame Select -->
        <div class="control-group">
            <label>‡ß®. ‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <select id="frameSelect" onchange="handleFrameChange()">
                <option value="1">Frame 1: ‡¶¶‡¶æ‡¶Å‡¶°‡¶º‡¶ø‡¶™‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶®</option>
                <option value="2">Frame 2: ‡¶®‡¶æ‡¶∞‡¶æ‡¶Ø‡¶º‡ßá ‡¶§‡¶æ‡¶ï‡¶¨‡ßÄ‡¶∞</option>
                <option value="3">Frame 3: ‡¶≤‡¶æ‡¶≤ ‡¶∏‡¶¨‡ßÅ‡¶ú‡ßá‡¶∞ ‡¶™‡¶§‡¶æ‡¶ï‡¶æ (Special)</option>
                <option value="4">Style 1 (Image)</option>
                <option value="5">Style 2 (Image)</option>
                <option value="6">Style 3 (Image)</option>
            </select>
            <div id="frameLoader" class="loader">‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>

        <!-- 3. Zoom & Options -->
        <div class="control-group">
            <label>‡ß©. ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®</label>
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; color: #666;">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡ßú</span>
            </div>
            <input type="range" id="zoomRange" min="0.5" max="3" step="0.1" value="1" oninput="handleZoom()">
            
            <div class="checkbox-wrapper">
                <input type="checkbox" id="showLogo" checked onchange="draw()">
                <label for="showLogo">‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®</label>
            </div>
        </div>

        <!-- 4. Download -->
        <button class="btn btn-download" onclick="downloadImage()">
            <span>‚¨áÔ∏è</span> ‡¶π‡¶æ‡¶á-‡¶ï‡ßã‡ßü‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
        </button>
    </div>
</div>

<!-- FOOTER -->
<footer class="site-footer">
    &copy; 2025 ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßÄ ‡¶™‡ßç‡¶∞‡¶ö‡¶æ‡¶∞‡¶£‡¶æ ‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞ ‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ì ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§
</footer>

<script>
    // --- APP VARIABLES ---
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const startMsg = document.getElementById('startMsg');
    const frameLoader = document.getElementById('frameLoader');
    
    // Assets
    let userImg = new Image();
    let logoImg = new Image();
    let externalFrameImg = new Image(); // Holds the loaded frame image for 4, 5, 6
    
    let imgLoaded = false;
    let logoLoaded = false;
    let externalFrameLoaded = false;
    
    // Load Logo
    const LOGO_URL = "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Bangladesh_Jamaat-e-Islami_Emblem.svg/500px-Bangladesh_Jamaat-e-Islami_Emblem.svg.png";
    logoImg.crossOrigin = "anonymous";
    logoImg.src = LOGO_URL;
    logoImg.onload = function() {
        logoLoaded = true;
        if(imgLoaded) draw();
    };

    // External Frame URLs (Proxied via weserv.nl to fix CORS/Security errors)
    const EXTERNAL_FRAMES = {
        "4": "https://images.weserv.nl/?url=justhasib.com/frame/frame1.png&output=png",
        "5": "https://images.weserv.nl/?url=justhasib.com/frame/frame2.png&output=png",
        "6": "https://images.weserv.nl/?url=justhasib.com/frame/frame3.png&output=png"
    };

    // --- STATE MANAGEMENT ---
    let scale = 1;
    let offsetX = 0;
    let offsetY = 0;
    
    let logoX = 50;
    let logoY = 50;
    let logoSize = 160;
    
    let isDraggingUser = false;
    let isDraggingLogo = false;
    let startX, startY;

    // Initial Paint
    ctx.fillStyle = "white";
    ctx.fillRect(0,0,1080,1080);

    // --- 1. UPLOAD HANDLER ---
    document.getElementById('uploadInput').addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = function(event) {
                userImg = new Image();
                userImg.onload = function() {
                    imgLoaded = true;
                    startMsg.style.display = 'none'; 
                    resetPosition(); 
                    handleFrameChange(); // Redraw with current frame
                }
                userImg.src = event.target.result;
            }
            reader.readAsDataURL(e.target.files[0]);
        }
    });

    // --- 2. FRAME CHANGE HANDLER ---
    function handleFrameChange() {
        const frameType = document.getElementById('frameSelect').value;
        
        // If it's a code-based frame (1-3)
        if (["1", "2", "3"].includes(frameType)) {
            externalFrameLoaded = false; // Disable image overlay
            draw();
        } 
        // If it's an image-based frame (4-6)
        else {
            frameLoader.style.display = 'block';
            externalFrameImg = new Image();
            externalFrameImg.crossOrigin = "anonymous";
            externalFrameImg.src = EXTERNAL_FRAMES[frameType];
            
            externalFrameImg.onload = function() {
                externalFrameLoaded = true;
                frameLoader.style.display = 'none';
                draw();
            };
            
            externalFrameImg.onerror = function() {
                frameLoader.style.display = 'none';
                alert("‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            };
        }
    }

    // --- 3. POSITIONING HELPER ---
    function resetPosition() {
        // "Cover" logic
        const sX = canvas.width / userImg.width;
        const sY = canvas.height / userImg.height;
        scale = Math.max(sX, sY); 
        
        offsetX = (canvas.width - userImg.width * scale) / 2;
        offsetY = (canvas.height - userImg.height * scale) / 2;
        
        document.getElementById('zoomRange').value = 1;
        
        // Reset Logo Position based on frame
        logoX = 50; logoY = 50;
    }

    function handleZoom() {
        if(!imgLoaded) return;
        const sliderVal = parseFloat(document.getElementById('zoomRange').value);
        const sX = canvas.width / userImg.width;
        const sY = canvas.height / userImg.height;
        const baseScale = Math.max(sX, sY);
        scale = baseScale * sliderVal;
        draw();
    }

    // --- 4. MAIN DRAWING ENGINE ---
    function draw() {
        // Clear
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // A. Layer 0: User Image
        if (imgLoaded) {
            // High quality smoothing
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(userImg, offsetX, offsetY, userImg.width * scale, userImg.height * scale);
        }

        // B. Layer 1: Frame
        const frameType = document.getElementById('frameSelect').value;
        
        if (externalFrameLoaded && ["4", "5", "6"].includes(frameType)) {
            // Draw External Image Frame
            ctx.drawImage(externalFrameImg, 0, 0, canvas.width, canvas.height);
        } else {
            // Draw Code Frame
            drawDigitalFrame(frameType);
        }
        
        // C. Layer 2: Logo
        if(logoLoaded && document.getElementById('showLogo').checked) {
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.shadowBlur = 15;
            ctx.shadowOffsetY = 5;
            ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
            // Reset shadows
            ctx.shadowColor = "transparent";
            ctx.shadowBlur = 0;
            ctx.shadowOffsetY = 0;
        }
    }

    // --- CODE FRAME DRAWER (1-3) ---
    function drawDigitalFrame(type) {
        const w = canvas.width;
        const h = canvas.height;
        ctx.textAlign = "center";
        ctx.lineJoin = "round";

        if (type === "1") { // Classic
            ctx.strokeStyle = "#006a4e"; ctx.lineWidth = 50; ctx.strokeRect(0, 0, w, h);
            
            // Bottom Bar with subtle gradient
            const grad = ctx.createLinearGradient(0, h-260, 0, h);
            grad.addColorStop(0, "#006a4e");
            grad.addColorStop(1, "#004d38");
            ctx.fillStyle = grad;
            ctx.fillRect(0, h - 260, w, 260);
            
            ctx.fillStyle = "white"; ctx.font = "bold 80px 'Hind Siliguri'"; 
            ctx.shadowColor="rgba(0,0,0,0.3)"; ctx.shadowBlur=4;
            ctx.fillText("‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ", w/2, h - 160);
            
            ctx.fillStyle = "#ffeb3b"; ctx.font = "bold 70px 'Hind Siliguri'"; 
            ctx.fillText("‡¶¶‡¶æ‡¶Å‡¶°‡¶º‡¶ø‡¶™‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶Ø‡¶º ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶®", w/2, h - 60);
            ctx.shadowColor="transparent";

        } else if (type === "2") { // Religious
            const grad = ctx.createLinearGradient(0,0,w,0); grad.addColorStop(0, "#004d38"); grad.addColorStop(1, "#006a4e");
            ctx.fillStyle = grad; ctx.fillRect(0, 0, w, 230);
            
            ctx.fillStyle = "#ffeb3b"; ctx.font = "60px 'Hind Siliguri'"; ctx.fillText("‡¶®‡¶æ‡¶∞‡¶æ‡¶Ø‡¶º‡ßá ‡¶§‡¶æ‡¶ï‡¶¨‡ßÄ‡¶∞", w/2 + 60, 95);
            ctx.fillStyle = "white"; ctx.font = "bold 95px 'Hind Siliguri'"; 
            ctx.shadowColor="rgba(0,0,0,0.5)"; ctx.shadowBlur=10;
            ctx.fillText("‡¶Ü‡¶≤‡ßç‡¶≤‡¶æ‡¶π‡ßÅ ‡¶Ü‡¶ï‡¶¨‡¶æ‡¶∞", w/2, 190);
            ctx.shadowColor="transparent";

            ctx.fillStyle = "#006a4e"; ctx.fillRect(0, h - 150, w, 150);
            ctx.fillStyle = "white"; ctx.font = "bold 65px 'Hind Siliguri'"; ctx.fillText("‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂ ‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ", w/2, h - 55);

        } else if (type === "3") { // REDESIGNED: Professional Flag Theme (Waves)
            
            // 1. Top Wave (Green Gradient)
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(w, 0);
            ctx.lineTo(w, 150);
            ctx.bezierCurveTo(w/2, 220, w/3, 80, 0, 150);
            ctx.closePath();
            
            const topGrad = ctx.createLinearGradient(0, 0, w, 0);
            topGrad.addColorStop(0, "#006a4e");
            topGrad.addColorStop(1, "#008562");
            ctx.fillStyle = topGrad;
            ctx.fill();

            // 2. Bottom Wave (Green with Red accent)
            ctx.beginPath();
            ctx.moveTo(0, h);
            ctx.lineTo(w, h);
            ctx.lineTo(w, h - 250);
            ctx.bezierCurveTo(w * 0.75, h - 350, w * 0.25, h - 150, 0, h - 280);
            ctx.closePath();
            ctx.fillStyle = "#006a4e";
            ctx.fill();

            // 3. Artistic Red Circle (Sun) - partially behind bottom wave, drawn ON TOP here for style
            ctx.beginPath();
            ctx.arc(w - 120, h - 280, 80, 0, 2 * Math.PI);
            ctx.fillStyle = "#f42a41";
            ctx.shadowColor = "rgba(0,0,0,0.2)"; ctx.shadowBlur = 15;
            ctx.fill();
            ctx.shadowColor = "transparent";

            // 4. Text - Professional Typography
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            
            // Top Text
            ctx.font = "600 50px 'Hind Siliguri'";
            ctx.fillText("‡¶¶‡ßá‡¶∂ ‡¶ó‡¶°‡¶º‡¶æ‡¶∞ ‡¶∂‡¶™‡¶• ‡¶®‡¶ø‡¶®", w/2, 110);
            
            // Bottom Text
            ctx.font = "bold 70px 'Hind Siliguri'";
            ctx.shadowColor = "rgba(0,0,0,0.3)"; ctx.shadowBlur = 4;
            ctx.fillText("‡¶ú‡¶æ‡¶Æ‡¶æ‡¶Ø‡¶º‡¶æ‡¶§‡ßá ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ‡¶ï‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶®", w/2, h - 60);
            ctx.font = "400 35px 'Hind Siliguri'";
            ctx.fillStyle = "#ffd700";
            ctx.fillText("‡¶∏‡ßé ‡¶≤‡ßã‡¶ï‡ßá‡¶∞ ‡¶∂‡¶æ‡¶∏‡¶® ‡¶ö‡¶æ‡¶á", w/2, h - 150);
            ctx.shadowColor = "transparent";
            
            // Border overlay
            ctx.strokeStyle = "#006a4e";
            ctx.lineWidth = 20;
            ctx.strokeRect(0,0,w,h);
        }
    }

    // --- 5. DRAG LOGIC ---
    const container = document.getElementById('canvasContainer');
    
    function getCanvasCoordinates(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        let clientX = e.touches ? e.touches[0].clientX : e.clientX;
        let clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY,
            rawX: clientX,
            rawY: clientY
        };
    }

    function startDrag(e) {
        if(!imgLoaded) return;
        const pos = getCanvasCoordinates(e);
        
        // Slightly larger hit area for logo
        if(logoLoaded && document.getElementById('showLogo').checked &&
           pos.x > logoX && pos.x < logoX + logoSize &&
           pos.y > logoY && pos.y < logoY + logoSize) {
            isDraggingLogo = true;
        } else {
            isDraggingUser = true;
        }
        startX = pos.rawX;
        startY = pos.rawY;
    }

    function moveDrag(e) {
        if(!isDraggingUser && !isDraggingLogo) return;
        const pos = getCanvasCoordinates(e);
        const rect = canvas.getBoundingClientRect();
        const scaleRatio = canvas.width / rect.width;
        
        const dx = (pos.rawX - startX) * scaleRatio;
        const dy = (pos.rawY - startY) * scaleRatio;
        
        if(isDraggingLogo) { logoX += dx; logoY += dy; }
        else { offsetX += dx; offsetY += dy; }
        
        startX = pos.rawX; startY = pos.rawY;
        draw();
        if(e.cancelable) e.preventDefault();
    }

    function endDrag() { isDraggingUser = false; isDraggingLogo = false; }

    container.addEventListener('mousedown', startDrag);
    window.addEventListener('mousemove', moveDrag);
    window.addEventListener('mouseup', endDrag);
    container.addEventListener('touchstart', startDrag, {passive: false});
    window.addEventListener('touchmove', moveDrag, {passive: false});
    window.addEventListener('touchend', endDrag);

    // --- 6. DOWNLOAD ---
    function downloadImage() {
        if(!imgLoaded) { alert("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); return; }
        
        const link = document.createElement('a');
        const timestamp = new Date().toISOString().replace(/[-:.]/g, "");
        link.download = `JIB-Frame-${timestamp}.png`;
        
        // High quality output
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
    }
</script>

</body>
</html>
